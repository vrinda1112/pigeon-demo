{% extends "layout.html" %} {% load static %}
{% block headerclass %}


{% endblock %}
{% block styleclass %}
.blue{
    background-color:blue;
}
th {
  border-top: 1px solid #dddddd;
  border-bottom: 1px solid #dddddd;
  border-right: 1px solid #dddddd;
}

th:first-child {
  border-left: 1px solid #dddddd;
}
{% endblock %}
{% block content %}

<div class="card ">
    <div class="border-white">

    <div class="card-header bg-transparent">
        <center>
            <h3 class="mt-3"> Production Sheet </h3>
        </center>
    </div>
    <div class="row mt-2">
            <label class="ml-3" for="datetimes" class="ml-2">Range:&nbsp;</label>
            <div class="col-lg-4">
                <input type="text" class="form-control" name="datetimes" id="datetimes">
            </div>
            <div class="col-lg-3">
                <button type="button" title="Update Chart" id="updateChart"
                                onclick="updateReport();" class="ml-2 mt-1 btn btn-sm"
                                style="background-color:#4B49AC!important;color:white!important;"
                                >
                            Update
                </button>
            </div>
        </div>
    </div>
    <div class="card-body">
        <div id="tabl_div">
            <table id="data_table" class="mdl-data-table cell-border stripe row-border " style="width:100%;"></table>
        </div>
    </div>
</div>

{% endblock %}
{% block js %}
<script type="text/javascript" src="//code.jquery.com/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="//stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript" src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="//cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
<script type="text/javascript" src="//cdn.datatables.net/buttons/1.5.6/js/dataTables.buttons.min.js"></script>

<script type="text/javascript" src="/static/js/moment.min.js"></script>
<link rel="stylesheet" type="text/css" href="/static/css/cards.min.css">
<script type="text/javascript" src='/static/js/daterangepicker.min.js'></script>
<link rel="stylesheet" type="text/css" href="/static/css/daterangepicker.css">

#added
<script type="text/javascript" src="https://cdn.datatables.net/fixedcolumns/4.0.1/js/dataTables.fixedColumns.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.0.1/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>

<!--<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>-->
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script type="text/javascript" src="//cdn.datatables.net/buttons/1.5.6/js/buttons.html5.min.js"></script>
<script type="text/javascript" src="//cdn.datatables.net/buttons/1.5.6/js/buttons.print.min.js"></script>
<script type="text/javascript" >
var fromDate = "{{ from|date:'dmYHi' }}";
var toDate = "{{ to|date:'dmYHi' }}";

$(function() {
  $('input[name="daterange"]').daterangepicker({
    opens: 'right'
  }, function(start, end, label) {
  });
});


function setDatePicker(){
  allfromdatepicker = $('input[id*="from_"]');
  $(allfromdatepicker).each(function (argument) {
    $(this).daterangepicker({
      datepickerOptions : {
         numberOfMonths : 2
      },

    });
    $('#datePickerDiv button[class*="comiseo-daterangepicker"]').addClass('selectbox');
  })

};
function cb(start, end) {
        fromDate = start.format('DDMMYYYYHHmm');
        toDate = end.format('DDMMYYYYHHmm');
}

$(document).ready(function() {
    $(function() {
        var start = moment().subtract(1, 'days');
        var end = moment();
        $('input[name="datetimes"]').daterangepicker({
            timePicker: true,
            startDate: start,
            endDate: end,
            maxDate: moment(),
            showDropdowns: true,
            linkedCalendars: false,
            locale: {
                format: 'DD/MMM/YYYY'
            },
            ranges: {
               'Today': [moment().startOf('day'), moment()],
               'Yesterday': [moment().subtract(1, 'days').startOf('day'), moment()],
               'Last 7 Days': [moment().subtract(6, 'days').startOf('day'), moment()],
               'This Month': [moment().startOf('month').startOf('day'), moment().endOf('month')],
               'Last 6 Months': [moment().subtract(6, 'month').startOf('month').startOf('day'), moment().subtract(1, 'month').endOf('month')],
            },
        }, cb);
        cb(start, end);
    });
});

const getDetails =() =>{

    $.ajax({
            url: '/prod_report_ajax',
            type: 'GET',
            async:false,
            data: {'fromDate':fromDate, 'endDate':toDate },
            success: function(response) {
                rows = response.data;
                columns_d = response.data[1]
                columns = []
                for (const [key, value] of Object.entries(columns_d)) {
                    columns.push({"title": key , "data": key, "sortable": true, "sDefaultContent": ''})
                    }
                },

            error: function(response) {
                console.log("Error in ajax ");
                rows =[]
                columns =[]
                return[rows,columns]
                }

        });
       return [rows,columns]
}

$(document).ready(function () {
    updateReport()
    });


function updateReport(){
    getDetails()
    if($.fn.DataTable.isDataTable('#data_table')){
            $('#data_table').dataTable().fnDestroy();
        }
    var tabl_div = document.getElementById('tabl_div');
    tabl_div.innerHTML='';
    tabl_div.innerHTML=  '<table id="data_table" class="table table-bordered " style="width:100%;"></table>';
            $('#data_table').DataTable({
                "orderFixed": [ 0, 'asc' ],
                "processing":true,
                "scrollX": true,
                "data" : rows,
                "searching": true,
                "sorting": true,
                "paging": true,
                "dom":"Bfrtip",
                "columns" : columns,
                buttons: [
                 {
                    extend: 'colvisGroup',
                    text: ' Reset',
                    show: ':hidden',
                    init: function(api, node, config) {
                        $(node).removeClass('dt-button');
                        $(node).addClass('btn btn-sm fa fa-refresh')
                    }
                },
                {
                    extend: 'colvis',
                    text: ' Parameters',
                    postfixButtons: [ 'colvisRestore' ],
                    collectionLayout: 'fixed two-column',
                    init: function(api, node, config) {
                        $(node).removeClass('dt-button');
                        $(node).addClass('btn btn-sm fa fa-filter')
                    }
                },
                 {
                    extend: 'excel',
                    text: ' Excel',
                    title: 'ProductionReport',
                    filename: 'Production Report',
                    init: function(api, node, config) {
                        $(node).removeClass('dt-button');
                        $(node).addClass('btn btn-sm fa fa-download')
                    },
                    exportOptions: {
                        columns: ':visible',
                        modifier: { page: 'all', search: 'none' }
                    }
                },

                {
                    extend: 'csvHtml5',
                    text: ' CSV',
                    title: 'ProductionReport',
                    filename: 'Production Report',
                    init: function(api, node, config) {
                        $(node).removeClass('dt-button');
                        $(node).addClass('btn btn-sm fa fa-download')
                    },
                    exportOptions: {
                        columns: ':visible',
                        modifier: { page: 'all', search: 'none' }
                    }
                },

                {
                    extend: 'pdfHtml5',
                    text: ' PDF',
                    title: 'ProductionReport',
                    filename: 'Production Report',

                    init: function(api, node, config) {
                        $(node).removeClass('dt-button');
                        $(node).addClass('btn btn-sm fa fa-download')
                    },
                    exportOptions: {
                        columns: ':visible',
                        modifier: { page: 'all', search: 'none' }
                    }
                },
            ],
                "columnDefs": [
               {
                        "targets": 2,
                        "createdCell": function (td, cellData, rowData, row, col) {

                              if ( cellData == "B" ) {
                                $(td).css('background-color', '#317393')
                              }
                              if ( cellData == "A" ){
                                $(td).css('background-color','#4ccc99');
                              }
                              if ( cellData == "C" ){
                                $(td).css('background-color','#E4ADC4');
                              }
                              if ( cellData == "G" ){
                                $(td).css('background-color',' #E0D268');
                              }
                         }
                    },
                    {
                        "targets": 19,
                        "createdCell":function (td, cellData, rowData, row, col) {
                           if ( cellData > "0" ) {
                                $(td).css('background-color', '#E4ADC4')
                                 $(td).css('color', '#740023')
                              }
                        }
                    },
                    {
                    "targets": '_all',
                    "createdCell":function (td, cellData, rowData, row, col) {
                        $(td).css('padding', '25px');
                        }
                    }


                 ]

            });
}

</script>
<script type="text/javascript" src="//cdn.datatables.net/buttons/1.5.6/js/buttons.colVis.min.js"></script>




{% endblock %}